window.Messenger=(function(){var d="[PROJECT_NAME]",a="postMessage" in window;function c(h,e,g){var f="";if(arguments.length<2){f="target error - target and name are both required"}else{if(typeof h!="object"){f="target error - target itself must be window object"}else{if(typeof e!="string"){f="target error - target name must be string type"}}}if(f){throw new Error(f)}this.target=h;this.name=e;this.prefix=g}if(a){c.prototype.send=function(e){this.target.postMessage(this.prefix+"|"+this.name+"__Messenger__"+e,"*")}}else{c.prototype.send=function(f){var e=window.navigator[this.prefix+this.name];if(typeof e=="function"){e(this.prefix+"|"+this.name+"__Messenger__"+f,window)}else{throw new Error("target callback function is not defined")}}}function b(f,e){this.targets={};this.name=f;this.listenFunc=[];this.prefix=e||d;this.initListen()}b.prototype.addTarget=function(g,e){var f=new c(g,e,this.prefix);this.targets[e]=f};b.prototype.initListen=function(){var f=this;var e=function(m){if(typeof m=="object"&&m.data){m=m.data}if(!m.split){return false}var l=m.split("__Messenger__");var m=l[1];var k=l[0].split("|");var j=k[0];var g=k[1];for(var h=0;h<f.listenFunc.length;h++){if(j+g===f.prefix+f.name){f.listenFunc[h](m)}}};if(a){if("addEventListener" in document){window.addEventListener("message",e,false)}else{if("attachEvent" in document){window.attachEvent("onmessage",e)}}}else{window.navigator[this.prefix+this.name]=e}};b.prototype.listen=function(h){var f=0;var e=this.listenFunc.length;var g=false;for(;f<e;f++){if(this.listenFunc[f]==h){g=true;break}}if(!g){this.listenFunc.push(h)}};b.prototype.clear=function(){this.listenFunc=[]};b.prototype.send=function(g){var e=this.targets,f;for(f in e){if(e.hasOwnProperty(f)){e[f].send(g)}}};return b})();var APF={log:function(a){}};APF.Namespace={register:function(d){var c=d.split(".");var a=window;for(var b=0;b<c.length;b++){if(typeof a[c[b]]=="undefined"){a[c[b]]=new Object()}a=a[c[b]]}return a}};APF.Utils={getWindowSize:function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return{width:b,height:a}},getScroll:function(){var b=0,a=0;if(typeof(window.pageYOffset)=="number"){a=window.pageYOffset;b=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollTop;b=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollTop;b=document.documentElement.scrollLeft}}}return{left:b,top:a}},setCookie:function(c,e,a,h,d,g){var b=new Date();b.setTime(b.getTime());if(a){a=a*1000*60*60*24}var f=new Date(b.getTime()+(a));document.cookie=c+"="+escape(e)+((a)?";expires="+f.toGMTString():"")+((h)?";path="+h:"")+((d)?";domain="+d:"")+((g)?";secure":"")},getCookie:function(a){var f=document.cookie.split(";");var b="";var d="";var e="";var c=false;for(i=0;i<f.length;i++){b=f[i].split("=");d=b[0].replace(/^\s+|\s+$/g,"");if(d==a){c=true;if(b.length>1){e=unescape(b[1].replace(/^\s+|\s+$/g,""))}return e;break}b=null;d=""}if(!c){return null}},deleteCookie:function(a,c,b){if(this.getCookie(a)){document.cookie=a+"="+((c)?";path="+c:"")+((b)?";domain="+b:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}},setScrollTop:function(a){if(document.body){document.body.scrollTop=a;if(document.body.scrollTop==0){if(document.documentElement){document.documentElement.scrollTop=a}}}else{if(document.documentElement){document.documentElement.scrollTop=a}}},getScrollTop:function(){return document.body?document.body.scrollTop||document.documentElement.scrollTop:document.documentElement.scrollTop},gotoScrollTop:function(f,d){var b=APF.Utils.getScrollTop(),h=0,g=0;var d=d||1;var f=f||0;var a=b>f?1:0;(function(){b=APF.Utils.getScrollTop();h=a?b-f:f-b;g=a?b-h/15*d:b+1+h/15*d;APF.Utils.setScrollTop(g);if(h<=0||b==APF.Utils.getScrollTop()){return}setTimeout(arguments.callee,10)})()}};APF.Namespace.register("ajk");(function(){var logger;var siteName=(function(){var hostData=document.location.host.match(/^(\w+)\.(\w+)\./);if(hostData){return"pc"}else{return"unknown"}})();var rAf=function(callback){window.setTimeout(callback,1000/10)};ajk.Logger=logger={sojSite:"",sojPage:"",sojPageName:"",errorSite:siteName};logger.setSite=function(site){this.sojSite=site||""};logger.setPage=function(page){this.sojPage=page||""};logger.setPageName=function(pagename){this.sojPageName=pagename||""};logger.config={devLogURL:"//s.anjuke.test/ts.html?",logURL:"http://m.anjuke.com/ts.html?",devSojURL:"//s.anjuke.test/stb",isDev:/dev|test/.test(document.domain),blackList:["Player","baiduboxapphomepagetag","onTouchMoveInPage"]};logger.isblack=function(str){var self=this;var i,reg,length,blackList=self.config.blackList;if(typeof str!=="string"){return true}for(i=0,length=blackList.length;i<length;i++){reg=new RegExp(blackList[i],"g");if(reg.test(str)){return true}}};logger.sendError=function(params){var self=this;var errorinfo="tp=error&site="+self.errorSite+"&msg=",key,url,arr=[],image,msg;if(typeof params==="string"){msg=params}if(typeof params==="object"){for(key in params){if(params.hasOwnProperty(key)){arr.push(key+":"+encodeURIComponent(JSON.stringify(params[key])))}}msg=arr.join(",")}if(self.isblack(msg)){return false}image=new Image();if(self.config.isDev){url=self.config.devLogURL+errorinfo+msg}else{url=self.config.logURL+errorinfo+msg}image.src=url;return true};var getScreen=function(){var sinfo={};sinfo.w=$(window).width().toString();sinfo.h=$(window).height().toString();sinfo.r=(window.devicePixelRatio&&window.devicePixelRatio>=2?1:0).toString();getScreen=function(){return sinfo};return sinfo};logger.sendSoj=function(op){var self=this;var _site=op.site||self.sojSite,soj=new SiteTracker(),t_params;if(op.customparam){soj.setCustomParam(op.customparam)}if(self.config.isDev){t_params={target_url:self.config.devSojURL}}var _page=op.page||self.sojPage,_pageName=op.pageName||self.sojPageName||_page;soj.setPage(_page);soj.setPageName(_pageName);soj.setSite(_site);soj.setScreen(getScreen());soj.setReferer(op.r||document.referrer);if(op.NGuid){soj.setNGuid(op.NGuid)}if(op.NUid){soj.setNUid(op.NUid)}if(op.h){if(!t_params){t_params={}}t_params.h=op.h}soj.track(t_params);try{if(!/npv/.test(_site)){var trackUrl=soj.getParams();delete trackUrl.cp;delete trackUrl.sc;window._trackURL=JSON.stringify(trackUrl);loadTrackjs()}}catch(e){}function loadTrackjs(){var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="http://tracklog.58.com/referrer_anjuke_pc.js?_="+Math.random();var b=document.body;s.onload=function(){soj.setSite(_site+"-npv");soj.setPage(_page+"_tracklog");soj.setPageName(_pageName+"_tracklog");soj.track(t_params)};s.onerror=function(){soj.setSite(_site+"-npv");soj.setPage(_page+"_tracklog_error");soj.setPageName(_pageName+"_tracklog_error");soj.track(t_params)};b.appendChild(s)}};logger.addLinkSoj=function(selector,attr,param){$("body").on("click",selector,function(e){var soj=$(this).data(attr||"soj")||$(this).attr(attr||"_soj"),_soj=$.trim(soj),href=$.trim($(this).attr("href")),_param=param||"from",_target=$(this).attr("target"),_hasTarget=_target!==undefined,_href;if(!_soj){return}if(!href){return}if(href.toLowerCase().indexOf("javascript")===0){return}e.preventDefault();e.stopPropagation();href=href.replace(/(&from=(.)*$)|(\?from=(.)*$)/,"");_href=(href.indexOf("?")!==-1)?href+"&"+_param+"="+_soj:href+"?"+_param+"="+_soj;if(_hasTarget){if(!
/*@cc_on!@*/
0){var winoper=window.open(_href,_target);winoper&&winoper.focus()}else{var _el=document.createElement("a");_el.href=_href;_el.target=_target;$(_el).appendTo("body").get(0).click();$(_el).remove()}}else{location.href=_href}})};logger.Exposure=function(op){var defaults={site:"",trackTag:"data-trace",delay:50,page:"",pageName:"",NUid:"",NGuid:"",prefix:""};this.ops=$.extend(defaults,op);this.domCache=[];this.pageViewHeight=$(window).height();this.timer=null;this.dataCache=[];this.expStatus=false;this.init()};logger.Exposure.prototype={constructor:logger.Exposure,add:function(list){var _this=this;this.expStatus=true;list.each(function(index,el){_this.domCache.push($(el))})},init:function(){var wd=$(window),self=this;wd.resize($.proxy(this.resize,this));wd.on("beforeunload",$.proxy(this.beforeunload,this));rAf(scroll);function scroll(){rAf(scroll);if(!self.expStatus){return}clearTimeout(self.timer);if(self.domCache.length===0){self.expStatus=false;self.buildData();return}self.timer=setTimeout(function(){$.proxy(self.addData,self)()},self.ops.delay)}},resize:function(){this.pageViewHeight=$(window).height()},beforeunload:function(){this.buildData()},scroll:function(){},sendExp:function(result){logger.sendSoj({NGuid:this.ops.NGuid,NUid:this.ops.NUid,site:this.ops.site,page:this.ops.prefix+this.ops.page,pageName:this.ops.prefix+this.ops.pageName,customparam:result})},addData:function(){var pageViewHeight=this.pageViewHeight,topY=$(window).scrollTop(),botY=topY+pageViewHeight,_this=this;if(this.domCache.length===0){return}$.each(this.domCache,function(index,val){var _topY,attr;if(!val){return}_topY=val.offset?val.offset().top:0;if(_topY>topY&&_topY<botY){attr=val.attr(_this.ops.trackTag);if(attr){_this.dataCache.push(attr)}delete _this.domCache[index]}});this.buildData()},buildData:function(){var _this=this,result={},r=[],exp,key,length,i;if(this.dataCache.length===0){return}exp=eval("(["+this.dataCache.join(",")+"])");this.dataCache=[];for(i=0,length=exp.length;i<length;i++){for(key in exp[i]){if(!result[key]){result[key]=[]}result[key].push(exp[i][key])}}for(key in result){r.push('"'+key+'":['+result[key].join(",")+"]")}this.sendExp('{"exposure":{'+r.join(",")+"}}");$.each(this.domCache,function(index,val){if(!val){_this.domCache.splice(index,1)}})}};window.onerror=function(msg,url,line){logger.sendError({message:msg,url:url,line:line})};$(function(){logger.addLinkSoj("a[_soj]")})})();APF.Namespace.register("ajk");(function(b,a){a.LoginIframe=function(d){var c=this;c.defaults={countTime:60,autoSustain:true,submitAutoSustain:false,countInterval:1000,smsLength:[4,6],captchaLength:4,phoneLength:11,curTabClassName:"cur",hiddenClassName:"hidden",noneClassName:"none",activeItemClassName:"active-item",checkedClassName:"checkbox-fake-checked",errorItemClassName:"error-item",autoUlHoverClassName:"cur",smsHideClassName:"control-item-sms-hide",domainNodeClass:".domainNode",emailNodeClass:".emailNode",smsDisableClassName:"sms-disabel-btn",submitDisableClassName:"submit-disable-btn",tipWrongNum:"请输入正确手机号码",tipWrongNumOrSms:"验证码错误",submiting_text:"登录中，请稍后...",phoneEmptyTip:"请输入手机号码",smsEmptyTip:"请输入验证码",captchaEmptyTip:"请输入验证码",userNameEmptyTip:"请输入手机号、邮箱或安居客用户名",pwdEmptyTip:"请输入密码"};c.ops=b.extend({},c.defaults,d);c.nodes={autoUl:b("#autoUl"),smsCheckboxLabel:b("#smsCheckboxLabel"),pwdCheckboxLabel:b("#pwdCheckboxLabel"),errorItemTop:b("#errorItemTop"),errorItemTopPwd:b("#errorItemTopPwd"),pwdLoginForm:b("#pwdLoginForm"),pwdTab:b("#pwdTab"),pwdCheckbox:b("#pwdCheckbox"),pwdCaptchaIpt:b("#pwdCaptchaIpt"),pwdSubmitBtn:b("#pwdSubmitBtn"),pwdUserNameIpt:b("#pwdUserNameIpt"),pwdIpt:b("#pwdIpt"),pwdCaptchaRefreshBtn:b("#pwdCaptchaRefreshBtn"),pwdTransitionNode:b("#pwdTransitionNode"),phoneIpt:b("#phoneIpt"),smsCaptchaRefreshBtn:b("#smsCaptchaRefreshBtn"),smsLoginForm:b("#smsLoginForm"),smsTab:b("#smsTab"),sendSmsBtn:b("#sendSmsBtn"),smsIpt:b("#smsIpt"),smsCheckbox:b("#smsCheckbox"),smsCaptchaIpt:b("#smsCaptchaIpt"),smsTransitionNode:b("#smsTransitionNode"),smsSubmitBtn:b("#smsSubmitBtn"),token2NodePwd:b("#token2NodePwd"),token2NodeSms:b("#token2NodeSms"),continueCountTimeNode:b("#continueCountTimeNode"),QQLogin:b("#QQLogin"),weiboLogin:b("#weiboLogin"),weixinLogin:b("#weixinLogin"),thirdLoginTitle:b("#thirdLoginTitle"),iframeLoginSuccess:b("#iframeLoginSuccess"),ifmFormContent:b("#ifmFormContent"),thirdsWrap:b("#thirdsWrap"),otherLoginWrap:b("#otherLoginWrap"),IframeLoginCloseBtn:b("#IframeLoginCloseBtn"),notNowBtn:b("#notNowBtn")};c.initSmsBtnHtml=c.nodes.sendSmsBtn.html();c.state={agree:true,captcha:false,captchaFrom:"",captchaShowed:false,needCaptcha:false,canSendSms:false,counting:false,sms:false,phone:false,submit:false,submiting:false};c.statePwd={agree:true,captcha:false,needCaptcha:false,captchaFrom:"",captchaShowed:false,submit:false,userName:false,pwd:false,submiting:false};c.trackAllocations=[{node:"smsLoginForm",act:"submit",code:"track_login_page_phone"},{node:"pwdLoginForm",act:"submit",code:"track_login_page_user"},{node:"smsTab",act:"click",code:"track_login_page_changetab"},{node:"pwdTab",act:"click",code:"track_login_page_changetab"},{node:"QQLogin",act:"click",code:"login_page_qq"},{node:"weiboLogin",act:"click",code:"login_page_weibo"},{node:"weixinLogin",act:"click",code:"login_page_weichat"},{node:"notNowBtn",act:"click",code:"track_login_phonetc_tgcb"},{node:"pwdUserNameIpt",act:"blur",code:"track_login_page_tcuser"}];c._init()};a.LoginIframe.prototype._init=function(){var c=this;c._bindEvent();c._getToken2();c._initInnerMsger();c._initTrack();c._initPhoneValidate()};a.LoginIframe.prototype._bindEvent=function(){var c=this;c.nodes.IframeLoginCloseBtn.on("click",function(d){c.send({name:"close"})});c.nodes.smsTab.on("click",function(d){d.preventDefault();c.toggleCurTab(this);c.show(c.nodes.smsLoginForm);c.hide(c.nodes.pwdLoginForm);return false});c.nodes.pwdTab.on("click",function(d){d.preventDefault();c.toggleCurTab(this);c.hide(c.nodes.smsLoginForm);c.show(c.nodes.pwdLoginForm);return false});c.nodes.smsCheckboxLabel.on("click",function(f){var d=c.nodes.smsCheckbox[0];if(d.checked){c.toggleSubmitBtn(true,"sms");c.toggleCheckbox(true,"sms")}else{c.toggleSubmitBtn(false,"sms");c.toggleCheckbox(false,"sms")}});c.nodes.pwdCheckboxLabel.on("click",function(f){var d=c.nodes.pwdCheckbox[0];if(d.checked){c.toggleSubmitBtn(true,"pwd");c.toggleCheckbox(true,"pwd")}else{c.toggleSubmitBtn(false,"pwd");c.toggleCheckbox(false,"pwd")}});c.nodes.smsCaptchaRefreshBtn.on("click",function(d){c.refreshCaptcha(this)});c.nodes.pwdCaptchaRefreshBtn.on("click",function(d){c.refreshCaptcha(this)});c.nodes.phoneIpt.on("input propertychange",function(d){c.phoneIptHandler()});c.nodes.phoneIpt.on("focus",function(d){c.toggleFocus(this,true);c.phoneIptHandler()});c.nodes.phoneIpt.on("blur",function(d){c.toggleFocus(this,false);c.validatePhone()});c.nodes.smsIpt.on("focus",function(d){c.toggleFocus(this,true)});c.nodes.smsIpt.on("input propertychange",function(d){var f=c.nodes.smsIpt.val();if(b.inArray(f.length,c.ops.smsLength)!==-1){c.validateSms()}});c.nodes.smsIpt.on("blur",function(d){c.toggleFocus(this,false);c.validateSms()});c.nodes.sendSmsBtn.on("click",function(f){if(!c.state.phone||c.state.counting){return false}else{var d={phone:c.nodes.phoneIpt.val(),token:c.ops.token,token2:c._getToken2(),captcha:"",multi_form:c.ops.multi_form};if(c.state.needCaptcha){d.captcha=c.nodes.smsCaptchaIpt.val()}b.ajax({url:c.ops.sendsmsApi,type:"get",data:d,dataType:"json",success:function(e){if(+e.code===0||+e.code===11020||+e.code===10106){if(+e.code===11020||+e.code===10106){c.showError(c.nodes.sendSmsBtn,e.msg,true)}else{c.hideError(c.nodes.sendSmsBtn,true)}c.state.needCaptcha=false;c.countDown()}else{if(+e.code===10001){c.state.needCaptcha=true;c.hideError(c.nodes.smsIpt,false);c.toggleCaptcha(true);c.state.captchaFrom="sms";setTimeout(function(){c.nodes.smsCaptchaIpt.focus()},500)}else{c.state.needCaptcha=false;c.showError(c.nodes.sendSmsBtn,e.msg,true)}}},error:function(e){}})}});c.nodes.smsCaptchaIpt.on("focus",function(d){c.toggleFocus(this,true)});c.nodes.smsCaptchaIpt.on("blur change keyup",function(d){var f=b.trim(b(this).val());if(d.type==="change"||d.type==="keyup"){if(f.length!==c.ops.captchaLength){return}}d.stopImmediatePropagation();c.toggleFocus(this,false);c.validateCaptcha("sms")});c.nodes.pwdCaptchaIpt.on("focus",function(d){c.toggleFocus(this,true)});c.nodes.pwdCaptchaIpt.on("blur",function(d){c.toggleFocus(this,false);c.validateCaptcha("pwd")});c.nodes.pwdUserNameIpt.on("focus",function(d){c.toggleFocus(this,true,true,true);c.autoCompleteUserName()});c.nodes.pwdUserNameIpt.on("blur",function(d){c.validateEmpty(this,c.ops.userNameEmptyTip,"userName");c.toggleFocus(this,false);if(!c.nodes.autoUl.find("."+c.ops.curTabClassName).length){c.hide(c.nodes.autoUl)}});c.nodes.pwdIpt.on("focus",function(d){c.toggleFocus(this,true,true,true);c.hide(c.nodes.autoUl)});c.nodes.pwdIpt.on("blur",function(d){c.validateEmpty(this,c.ops.pwdEmptyTip,"pwd");c.toggleFocus(this,false)});c.nodes.pwdUserNameIpt.on("input propertychange",function(d){c.autoCompleteUserName()});c.nodes.autoUl.on("mouseenter","li",function(d){b(this).addClass(c.ops.autoUlHoverClassName).siblings().removeClass(c.ops.autoUlHoverClassName)});c.nodes.autoUl.on("mouseleave","li",function(d){b(this).removeClass(c.ops.autoUlHoverClassName)});c.nodes.autoUl.on("click","li",function(f){var d=b(this).find(c.ops.domainNodeClass).html()+b(this).find(c.ops.emailNodeClass).html();c.nodes.pwdUserNameIpt.val(d);c.hide(c.nodes.autoUl)});c.nodes.smsLoginForm.on("submit",function(f){var d=true;if(c.state.submiting||!c.state.agree){f.preventDefault();return false}if(!c.state.phone){if(!c.validatePhone()){d=false}}if(!c.state.sms){if(d){if(!c.validateSms()){d=false}}}if(c.state.captchaShowed&&!c.state.captcha){if(d){c.validateCaptcha("sms")}}if(!c.canSmsFormSubmit("sync")){return false}if(!c.state.captcha){c.trySubmitForm()}if(!c.canSmsFormSubmit()){c.state.submit=false;c.state.submiting=false;f.preventDefault();return false}c.beforeSubmit();c.setSubmitting("sms")});c.nodes.pwdLoginForm.on("submit",function(d){if(c.statePwd.submiting||!c.statePwd.agree){d.preventDefault();return false}if(c.statePwd.captchaShowed&&!c.statePwd.captcha){c.validateCaptcha("pwd")}c.validateEmpty(c.nodes.pwdUserNameIpt,c.ops.userNameEmptyTip,"userName");c.validateEmpty(c.nodes.pwdIpt,c.ops.pwdEmptyTip,"pwd");if(!c.canPwdFormSubmit("sync")){return false}if(!c.statePwd.captcha){c.trySubmitForm("pwd")}if(!c.canPwdFormSubmit()){c.statePwd.submit=false;c.statePwd.submiting=false;d.preventDefault();return false}c.setSubmitting("pwd")})};a.LoginIframe.prototype._initTrack=function(){var c=this;b.each(c.trackAllocations,function(e,d){c.nodes[d.node].on(d.act,function(f){ajk.Logger.sendSoj({page:d.code,pageName:d.code,site:"anjuke-npv"})})})};a.LoginIframe.prototype.beforeSubmit=function(){var c=this;var d=c.nodes.sendSmsBtn.html().match(/\d+/);if(d){c.nodes.continueCountTimeNode.val(d[0])}};a.LoginIframe.prototype._initPhoneValidate=function(){var c=this;if(c.nodes.phoneIpt.length&&c.nodes.phoneIpt.val().length===c.ops.phoneLength){if(c.ops.continueCountTime){c.countDown(c.ops.continueCountTime)}c.validatePhone(function(d){c.hintLoginError()})}if(c.nodes.pwdUserNameIpt.length&&c.nodes.pwdUserNameIpt.val().length){c.validateEmpty(c.nodes.pwdUserNameIpt,c.ops.userNameEmptyTip,"userName");c.visable(c.nodes.errorItemTopPwd)}};a.LoginIframe.prototype.hintLoginError=function(){var c=this;c.visable(c.nodes.errorItemTop)};a.LoginIframe.prototype._initInnerMsger=function(){var c=this;c.innerMsger=new Messenger("iframe","login");if(window.parent){c.innerMsger.addTarget(window.parent,"parent")}c.innerMsger.listen(function(d){c._handleReceive(d)})};a.LoginIframe.prototype._handleReceive=function(e){var c=this;var d=JSON.parse(e);if(d.name==="showSuccess"){c.nodes.ifmFormContent.addClass("none");c.nodes.thirdLoginTitle.addClass("none");c.nodes.thirdsWrap.addClass("none");c.nodes.otherLoginWrap.addClass("none");c.nodes.iframeLoginSuccess.removeClass("none")}if(d.name==="reset"){c.reset(d.args)}if(d.name==="soj"){ajk.Logger.sendSoj({page:d.args,pageName:d.args,site:"anjuke-npv"})}};a.LoginIframe.prototype.send=function(d){var c=this;c.innerMsger.send(JSON.stringify(d))};a.LoginIframe.prototype.setSubmitting=function(e){var c=this;var d=c.nodes[e+"SubmitBtn"];d.addClass(c.ops.submitDisableClassName).val(c.ops.submiting_text)};a.LoginIframe.prototype.autoCompleteUserName=function(){var c=this;var d=c.nodes.pwdUserNameIpt;var e=d.val();if(/\@$/.test(e)){e=e.replace(/\@$/,"");c.nodes.autoUl.find(c.ops.domainNodeClass).html(e);c.show(c.nodes.autoUl)}else{c.hide(c.nodes.autoUl)}};a.LoginIframe.prototype.trySubmitForm=function(g){var c=this;var d={account:c.nodes.phoneIpt.val()};var f=c.state;var e=c.nodes.smsLoginForm;if(g){f=c.statePwd;e=c.nodes.pwdLoginForm;d.account=c.nodes.pwdUserNameIpt.val()}b.ajax({url:c.ops.showCaptchaApi,type:"get",dataType:"json",data:d,success:function(h){if(+h.code===0||f.captcha){f.submit=true;if(g){if(c.canPwdFormSubmit()){f.captcha=true;e.submit();f.submiting=true}}else{if(c.canSmsFormSubmit()){f.captcha=true;e.submit();f.submiting=true}}}else{f.captchaFrom="submit";if(g){f.captchaFrom="pwdSubmit"}f.needCaptcha=true;c.toggleCaptcha(true,g)}},error:function(h){}})};a.LoginIframe.prototype.canSmsFormSubmit=function(g){var c=this;var e=c.state;var d=e.agree&&e.phone&&e.sms;if(g){return d}var f=d&&e.submit;if(e.needCaptcha){return f&&e.captcha}else{return f}};a.LoginIframe.prototype.canPwdFormSubmit=function(g){var c=this;var e=c.statePwd;var d=e.agree&&e.userName&&e.pwd;if(g){return d}var f=d&&e.submit;if(e.needCaptcha){return f&&e.captcha}else{return f}};a.LoginIframe.prototype.toggleFocus=function(f,c,e,h){var d=this;var g=b(f).parents(".controlItemNode");if(c){g.addClass(d.ops.activeItemClassName)}else{g.removeClass(d.ops.activeItemClassName)}};a.LoginIframe.prototype.toggleCaptcha=function(c,h){var d=this;var g=d.state;var k=d.nodes.smsCaptchaIpt;var f=d.nodes.smsIpt;var e=d.nodes.smsCaptchaRefreshBtn;var j=d.nodes.smsTransitionNode;if(h){g=d.statePwd;k=d.nodes.pwdCaptchaIpt;f=d.nodes.pwdIpt;e=d.nodes.pwdCaptchaRefreshBtn;j=d.nodes.pwdTransitionNode}g.captchaShowed=c;if(c){k.val("");g.captcha=false;e.click();j.addClass(d.ops.smsHideClassName);k.prop("tabindex",3);f.prop("tabindex",-1);k.prop("readonly",false)}else{j.removeClass(d.ops.smsHideClassName);k.prop("tabindex",-1);f.prop("tabindex",2);k.prop("readonly",true)}b("body").focus()};a.LoginIframe.prototype.countDown=function(f){var e=this;var g=e.nodes.sendSmsBtn.html();var d="重新发送";var c=f||e.ops.countTime;e.state.counting=true;e.nodes.sendSmsBtn.addClass(e.ops.smsDisableClassName);setTimeout(function h(){if(c--===0){e.state.counting=false;if(e.state.canSendSms){e.nodes.sendSmsBtn.html(d);e.nodes.sendSmsBtn.removeClass(e.ops.smsDisableClassName)}else{e.nodes.sendSmsBtn.html(e.initSmsBtnHtml)}}else{e.nodes.sendSmsBtn.html("已发送("+c+")");setTimeout(h,e.ops.countInterval)}},e.ops.countInterval)};a.LoginIframe.prototype.phoneIptHandler=function(){var c=this;var d=c.nodes.phoneIpt.val();if(d.length===c.ops.phoneLength){ajk.Logger.sendSoj({page:"track_login_page_tcphone",pageName:"track_login_page_tcphone",site:"anjuke-npv"});c.validatePhone()}else{c.state.phone=false;c.toggleSuccessIcon(c.nodes.phoneIpt,false);c.toggleSmsBtn(false)}};a.LoginIframe.prototype.validateCaptcha=function(d){var c=this;var f=c.state;var h=c.nodes[d+"CaptchaIpt"];var g=h.val();if(d==="pwd"){f=c.statePwd}c["inputedCaptcha"+d]=g;var e={captcha:g};if(h.prop("readonly")||!f.needCaptcha){return false}if(g.length===0&&f.captchaShowed){f.captcha=false;c.toggleSuccessIcon(h,false);c.showError(c.nodes[d+"CaptchaIpt"],c.ops.captchaEmptyTip);return false}b.ajax({url:c.ops.captchaCheckApi,type:"get",data:e,dataType:"json",success:function(j){if(+j.code===0){if(c["inputedCaptcha"+d]!==h.val()){return false}else{c.hideError(h);f.captcha=true;f.submit=true;if(c.ops.autoSustain){if(f.captchaFrom==="sms"&&f.canSendSms){c.toggleCaptcha(false,d==="pwd");c.nodes.sendSmsBtn.click().addClass("sms-btn-hover");c.nodes.smsIpt.focus();setTimeout(function(){c.nodes.sendSmsBtn.removeClass("sms-btn-hover")},800)}else{if(f.captchaFrom==="submit"&&c.canSmsFormSubmit("synced")&&c.ops.submitAutoSustain){c.nodes.smsSubmitBtn.click()}else{if(f.captchaFrom==="pwdSubmit"&&c.canPwdFormSubmit("synced")&&c.ops.submitAutoSustain){c.nodes.pwdSubmitBtn.click()}else{if(!c.ops.submitAutoSustain){c.toggleCaptcha(false,d==="pwd")}}}}}else{c.toggleCaptcha(false,d==="pwd")}f.captchaFrom="";if(c.state.phone){c.toggleSmsBtn(true)}else{c.toggleSmsBtn(false)}}}else{f.captcha=false;c.toggleSuccessIcon(h,false);c.showError(c.nodes[d+"CaptchaIpt"],j.msg)}},error:function(j){window.console&&console.log("网络错误")}})};a.LoginIframe.prototype.validateSms=function(){var c=this;var d=c.nodes.smsIpt.val();if(b.inArray(d.length,c.ops.smsLength)!==-1){c.hideError(c.nodes.smsIpt,false);c.state.sms=true;return true}else{if(d.length===0){c.showError(c.nodes.smsIpt,c.ops.smsEmptyTip,false)}else{c.showError(c.nodes.smsIpt,c.ops.tipWrongNumOrSms,false)}c.state.sms=false;return false}};a.LoginIframe.prototype.validatePhone=function(g){var e=this;var d=e.nodes.phoneIpt.val();var c=/^1\d{10}$/;if(c.test(d)){e.inputedNum=d;var f={phone:d};e.toggleLoading(e.nodes.phoneIpt,true);b.ajax({url:e.ops.phoneCheckApi,type:"get",data:f,dataType:"json",success:function(h){e.toggleLoading(e.nodes.phoneIpt,false);if(+h.code===0){if(e.nodes.phoneIpt.val()!==e.inputedNum){return false}else{e.state.phone=true;e.toggleSuccessIcon(e.nodes.phoneIpt,true);e.hideError(e.nodes.phoneIpt);if(e.state.needCaptcha){if(e.state.captcha){e.toggleSmsBtn(true)}else{return false}}else{e.toggleSmsBtn(true)}}}else{e.showError(e.nodes.phoneIpt,h.msg);e.state.phone=false;e.toggleSuccessIcon(e.nodes.phoneIpt,false);e.toggleSmsBtn(false)}g&&g(h)},error:function(h){e.toggleLoading(e.nodes.phoneIpt,false);window.console&&console.log("网络错误")}})}else{if(d.length===0){e.showError(e.nodes.phoneIpt,e.ops.phoneEmptyTip)}else{e.showError(e.nodes.phoneIpt,e.ops.tipWrongNum)}e.state.phone=false;e.toggleSuccessIcon(e.nodes.phoneIpt,false);e.toggleSmsBtn(false);return false}};a.LoginIframe.prototype.validateEmpty=function(d,f,g){var c=this;var e=b(d).val();if(e.length>0){c.hideError(d,true,true);c.statePwd[g]=true;c.toggleSuccessIcon(d,true);return true}else{c.showError(d,f,true,true);c.statePwd[g]=false;c.toggleSuccessIcon(d,false);return false}};a.LoginIframe.prototype.toggleSmsBtn=function(c){var d=this;d.state.canSendSms=c;if(d.state.counting){return false}if(c){d.nodes.sendSmsBtn.removeClass(d.ops.smsDisableClassName)}else{d.nodes.sendSmsBtn.addClass(d.ops.smsDisableClassName)}};a.LoginIframe.prototype.toggleSubmitBtn=function(c,e){var d=this;var f=d.state;if(e==="pwd"){f=d.statePwd}f.agree=c;if(c){d.nodes[e+"SubmitBtn"].removeClass(d.ops.submitDisableClassName)}else{d.nodes[e+"SubmitBtn"].addClass(d.ops.submitDisableClassName)}};a.LoginIframe.prototype.toggleCheckbox=function(c,e){var d=this;if(c){d.nodes[e+"Checkbox"].next().addClass(d.ops.checkedClassName)}else{d.nodes[e+"Checkbox"].next().removeClass(d.ops.checkedClassName)}};a.LoginIframe.prototype.showError=function(e,j,d,h){var c=this;var k=b(e).parents(".itemNode");var g=k.find(".errorItem");var f=b(e).parents(".controlItemNode");if(d){g=c.nodes.errorItemTop}if(h){g=c.nodes.errorItemTopPwd}if(j){g.html(j)}c.visable(g);f.addClass(c.ops.errorItemClassName)};a.LoginIframe.prototype.hideError=function(e,d,h){var c=this;var j=b(e).parents(".itemNode");var g=j.find(".errorItem");var f=j.find(".controlItemNode");if(d){g=c.nodes.errorItemTop}if(h){g=c.nodes.errorItemTopPwd}c.hidden(g);f.removeClass(c.ops.errorItemClassName)};a.LoginIframe.prototype.toggleSuccessIcon=function(e,c){var d=this;var g=b(e).parents(".itemNode");var f=g.find(".iconOK");if(c){d.visable(f)}else{d.hidden(f)}};a.LoginIframe.prototype.toggleLoading=function(e,c){var d=this;var g=b(e).parents(".itemNode");var f=g.find(".iconOK");if(c){f.addClass("loading")}else{f.removeClass("loading")}};a.LoginIframe.prototype.refreshCaptcha=function(f){var d=this;var g=b(f).prev();var c=g.attr("src");var e=c.replace(/timestamp\=\w*/,"timestamp="+(+new Date()));setTimeout(function(){g.attr("src",e)},50)};a.LoginIframe.prototype.toggleCurTab=function(d){var c=this;b(d).addClass(c.ops.curTabClassName).siblings().removeClass(c.ops.curTabClassName)};a.LoginIframe.prototype.hidden=function(d){var c=this;b(d).addClass(c.ops.hiddenClassName)};a.LoginIframe.prototype.visable=function(d){var c=this;b(d).removeClass(c.ops.hiddenClassName)};a.LoginIframe.prototype.show=function(d){var c=this;b(d).removeClass(c.ops.noneClassName)};a.LoginIframe.prototype.hide=function(d){var c=this;b(d).addClass(c.ops.noneClassName)};a.LoginIframe.prototype._getToken2=function(){var d=this;var f={algo1:["hex_md5"],algo2:["hex_sha1"],algo3:["sha256"],algo4:["hex_md5","hex_sha1"],algo5:["hex_sha1","sha256"]};var c=f[d.ops.algo];var e=d.ops.token;if(!d.ops.algo||!c||!e){return}b.each(c,function(h,g){e=window[g](e)});d.nodes.token2NodeSms.val(e);d.nodes.token2NodePwd.val(e);return e};a.LoginIframe.prototype.reset=function(c){if(c==="sms"){this.resetSmsForm()}else{if(c==="pwd"){this.resetPwdForm()}else{if(!!c===true){this.resetSmsForm();this.resetPwdForm();this.nodes.smsTab.trigger("click")}else{if(!!c===false||c===undefined){this.nodes.smsLoginForm.length&&this.resetSmsForm();this.nodes.pwdLoginForm.length&&this.resetPwdForm()}}}}};a.LoginIframe.prototype.resetSmsForm=function(){var c=this;if(!c.state.counting){c.nodes.sendSmsBtn.html(c.initSmsBtnHtml);c.toggleSmsBtn(false)}if(!c.nodes.smsCheckbox[0].checked){c.nodes.smsCheckbox.click()}c.toggleCaptcha(false);c.toggleSuccessIcon(c.nodes.phoneIpt,false);c.toggleSuccessIcon(c.nodes.smsCaptchaIpt,false);c.nodes.phoneIpt.val("");c.nodes.smsIpt.val("");c.nodes.smsCaptchaIpt.val("");c.hideError(c.nodes.phoneIpt);c.hideError(c.nodes.smsIpt,false);c.hideError(c.nodes.smsCaptchaIpt)};a.LoginIframe.prototype.resetPwdForm=function(){var c=this;if(!c.nodes.pwdCheckbox[0].checked){c.nodes.pwdCheckbox.click()}c.toggleCaptcha(false,"pwd");c.toggleSuccessIcon(c.nodes.pwdUserNameIpt,false);c.nodes.pwdUserNameIpt.val("");c.nodes.pwdIpt.val("");c.hideError(c.nodes.pwdUserNameIpt,true);c.hideError(c.nodes.pwdIpt,"top","pwd")}})(jQuery,ajk);